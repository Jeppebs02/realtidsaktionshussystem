@page
@using AuctionHouse.ClassLibrary.Enum
@model AuctionHouse.WebSite.Pages.CreateAuction.IndexModel
@{
}

@{
    ViewData["Title"] = "Create Auction";
}


<html>

<head>

</head>


<body>
    <h1>Create Auction</h1>
    <br />

    <form method="post" enctype="multipart/form-data" asp-page-handler="CreateAuction">

        <!-- Create Item -->
        <div>
            <label for="itemName"> Write the name of the item here: </label>
            <input type="text" name="itemName" required />
            <br />
        </div>
        <div>
            <label for="itemDescription"> Write the description of the item here: </label>
            <input type="text" name="itemDescription" required />
            <br />
        </div>
        <div>
            <label for="category">Choose a category:</label>

            <select id="category" name="category">
                <option value="">— Select a category —</option>
                @foreach (var category in @Model.Categories)
                {
                    <option value="@category">@category.ToString().Replace("_", " ")</option>
                }
            </select>
            <br />
        </div>
        <div>
            <label for="image">Upload a picture (JPEG/PNG/GIF):</label>
            <input type="file"
                   id="image"
                   name="ImageFile"
                   accept="image/*"
                   required />

            <!-- Live preview -->
            <img id="preview" alt="Image preview" hidden style="max-width:240px;margin-top:1rem;" />
        </div>
        <!-- Create Auction -->
        <div>
            <label for="startTime"> Choose the time ur auction should start: </label>
            <input type="datetime-local" id="startTime" name="startTime" required />
            <br />
        </div>
        <div>
            <label for="endTime"> Choose the time ur auction should end: </label>
            <input type="datetime-local" id="endTime" name="endTime" required />
            <br />
        </div>
        <div>
            <label for="startPrice"> Start price of ur item: </label>
            <input type="number" step="0.01" name="startPrice" required />
            <br />
        </div>
        <div>
            <label for="buyOutPrice"> Choose the buyout price: </label>
            <input type="number" step="0.01" name="buyOutPrice" />
            <br />
        </div>
        <div>
            <label for="minimumBidIncrement"> Choose the minimum bid increment my sir: </label>
            <input type="number" step="0.01" name="minimumBidIncrement" required />
            <br />
        </div>



        <button type="submit">Create Auction</button>
    </form>


    <!-- Error string check -->
    @if (!string.IsNullOrEmpty(Model.errorMessage))
    {
        <script>
            alert('@Model.errorMessage');
        </script>
    }




</body>



</html>






<script>


    const fileInput = document.getElementById('image');
    const preview   = document.getElementById('preview');



    let objectUrl;

    fileInput.addEventListener('change', () => {
        try {
            if (objectUrl) {
                URL.revokeObjectURL(objectUrl); // Free previous object URL
            }

            //Possibly make it take only the first file.
            const [file] = fileInput.files;
            if (file) {
                objectUrl = URL.createObjectURL(file);
                preview.src = objectUrl;
                preview.hidden = false;
            } else {
                preview.hidden = true;
                preview.removeAttribute('src');
            }
        } catch (err) {
            console.error("Image preview error:", err);
            alert("Preview failed: " + err.message);
        }
    });




</script>
